import{c as le,g as se}from"./QBtn.05cc85bc.js";import{h as oe}from"./QItem.1d159982.js";import{r as f,c as N,o as F,a as ne,h as ie,g as ue,_ as re,J as ce,H as V,K as I,L as de,M as _,N as d,a4 as o,S as j,P as y,Q as m,an as q,O as C}from"./index.be92eb65.js";import{c as me,a as U}from"./QPage.c570699c.js";import{Q as B}from"./QBanner.f5c82825.js";import{a as D,Q as M}from"./QCard.637394b8.js";import{a as pe,b as ve,f as fe,h as _e,i as he}from"./networkAddressAPIs.0547eb9b.js";import{a as E}from"./axios.a596eead.js";const $=XMLHttpRequest,H=$.prototype.open,be=["top","right","bottom","left"];let L=[],T=0;function ge({p:e,pos:l,active:p,horiz:n,reverse:u,dir:v}){let t=1,a=1;return n===!0?(u===!0&&(t=-1),l==="bottom"&&(a=-1),{transform:`translate3d(${t*(e-100)}%,${p?0:a*-200}%,0)`}):(u===!0&&(a=-1),l==="right"&&(t=-1),{transform:`translate3d(${p?0:v*t*-200}%,${a*(e-100)}%,0)`})}function ye(e,l){return typeof l!="number"&&(e<25?l=Math.random()*3+3:e<65?l=Math.random()*3:e<85?l=Math.random()*2:e<99?l=.6:l=0),oe(e+l,0,100)}function Se(e){T++,L.push(e),!(T>1)&&($.prototype.open=function(l,p){const n=[],u=()=>{L.forEach(t=>{(t.hijackFilter.value===null||t.hijackFilter.value(p)===!0)&&(t.start(),n.push(t.stop))})},v=()=>{n.forEach(t=>{t()})};this.addEventListener("loadstart",u,{once:!0}),this.addEventListener("loadend",v,{once:!0}),H.apply(this,arguments)})}function ke(e){L=L.filter(l=>l.start!==e),T=Math.max(0,T-1),T===0&&($.prototype.open=H)}var z=le({name:"QAjaxBar",props:{position:{type:String,default:"top",validator:e=>be.includes(e)},size:{type:String,default:"2px"},color:String,skipHijack:Boolean,reverse:Boolean,hijackFilter:Function},emits:["start","stop"],setup(e,{emit:l}){const{proxy:p}=ue(),n=f(0),u=f(!1),v=f(!0);let t=0,a=null,g;const A=N(()=>`q-loading-bar q-loading-bar--${e.position}`+(e.color!==void 0?` bg-${e.color}`:"")+(v.value===!0?"":" no-transition")),s=N(()=>e.position==="top"||e.position==="bottom"),S=N(()=>s.value===!0?"height":"width"),w=N(()=>{const c=u.value,b=ge({p:n.value,pos:e.position,active:c,horiz:s.value,reverse:p.$q.lang.rtl===!0&&["top","bottom"].includes(e.position)?e.reverse===!1:e.reverse,dir:p.$q.lang.rtl===!0?-1:1});return b[S.value]=e.size,b.opacity=c?1:0,b}),O=N(()=>u.value===!0?{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":n.value}:{"aria-hidden":"true"});function h(c=300){const b=g;return g=Math.max(0,c)||0,t++,t>1?(b===0&&c>0?k():a!==null&&b>0&&c<=0&&(clearTimeout(a),a=null),t):(a!==null&&clearTimeout(a),l("start"),n.value=0,a=setTimeout(()=>{a=null,v.value=!0,c>0&&k()},u.value===!0?500:1),u.value!==!0&&(u.value=!0,v.value=!1),t)}function r(c){return t>0&&(n.value=ye(n.value,c)),t}function i(){if(t=Math.max(0,t-1),t>0)return t;a!==null&&(clearTimeout(a),a=null),l("stop");const c=()=>{v.value=!0,n.value=100,a=setTimeout(()=>{a=null,u.value=!1},1e3)};return n.value===0?a=setTimeout(c,1):c(),t}function k(){n.value<100&&(a=setTimeout(()=>{a=null,r(),k()},g))}let x;return F(()=>{e.skipHijack!==!0&&(x=!0,Se({start:h,stop:i,hijackFilter:N(()=>e.hijackFilter||null)}))}),ne(()=>{a!==null&&clearTimeout(a),x===!0&&ke(h)}),Object.assign(p,{start:h,stop:i,increment:r}),()=>ie("div",{class:A.value,style:w.value,...O.value})}});const Ne={class:"select"},Ie={key:0,class:"my-cards"},Te={class:""},we={class:""},xe={style:{}},je={class:""},Ce={class:""},Le={style:{}},Ae={class:"grafana-main"},Oe={key:0,class:"grafana"},Be=["src"],De=ce({__name:"TroubleShooting",setup(e){const l=f({label:"",id:0}),p=f(),n=f(!1),u=f(""),v=f([]),t=f({__name__:"",device_name:"",device_role:"",instance:"",job:"",site_name:"",site_status:"",site_tenant:""}),a=f(""),g=f(""),A=[{label:"Last 5 minutes",value:"5m"},{label:"Last 15 minutes",value:"15m"},{label:"Last 30 minutes",value:"30m"},{label:"Last 1 hour",value:"1h"},{label:"Last 3 hours",value:"3h"},{label:"Last 6 hours",value:"6h"},{label:"Last 12 hours",value:"12h"},{label:"Last 24 hours",value:"24h"},{label:"Last 2 days",value:"2d"},{label:"Last 90 days",value:"90d"}],s=V({accountNumber:"",clientName:"",ipAssigned:"",onuSerialNumber:"",oltIp:"",onuMacAddress:"",onuDeviceName:"",packageTypeId:"",oltSite:"",oltInterface:""}),S=V({upStream:"",downStream:""}),w=async()=>{const h=await pe();v.value=h.map(r=>({onuDeviceName:r.onuDeviceName,id:r.id}))},O=async(h,r)=>{const i=p.value;i==null||i.start();const k=await E.get(`http://172.91.10.129:9090/api/v1/query?query=lo_status{job=%22ip_address%22,site_tenant=%22DCTECH%22,device_name="${h}"}`);t.value=k.data.data.result[0].metric,a.value=k.data.data.result[0].value[1];const x=await E.get(`http://172.91.10.129:9090/api/v1/query?query=lo_status{job=%22ip_address%22,site_tenant=%22DCTECH%22,device_name="${t.value.site_name}"}`);g.value=x.data.data.result[0].value[1];const c=await ve(r),{accountNumber:b,clientName:J,ipAssigned:K,oltIp:P,onuDeviceName:X,onuMacAddress:G,onuSerialNumber:W,packageTypeId:Q}=c;s.accountNumber=b,s.clientName=J,s.ipAssigned=K,s.oltIp=P,s.onuDeviceName=X,s.onuMacAddress=G,s.onuSerialNumber=W,s.packageTypeId=Q;const Y=await fe(P),{olt_site:Z}=Y;s.oltSite=Z;const R=await _e(Q),{upstream:ee,downstream:te}=R;S.upStream=ee,S.downStream=te;const ae=await he(h);s.oltInterface=ae,i==null||i.stop(),n.value=!0};return F(()=>{w()}),(h,r)=>(I(),de(me,{padding:""},{default:_(()=>[d(z,{color:"secondary",position:"bottom"}),o("div",Ne,[d(U,{modelValue:l.value,"onUpdate:modelValue":[r[0]||(r[0]=i=>l.value=i),r[1]||(r[1]=i=>O(l.value.label,l.value.id))],options:v.value.map(i=>({label:i.onuDeviceName,id:i.id})),label:"Select Subscriber",filled:"",class:"select-subscriber","map-option":""},null,8,["modelValue","options"]),d(U,{modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=i=>u.value=i),options:A,label:"Select Time",filled:"",class:"select-subscriber","emit-value":"","map-options":""},null,8,["modelValue"]),d(se,{icon:"autorenew",class:"cursor-pointer q-mx-sm",onClick:w,flat:""})]),d(z,{ref_key:"bar",ref:p,color:"info",position:"bottom",size:"10px","skip-hijack":""},null,512),n.value?(I(),j("div",Ie,[d(M,null,{default:_(()=>[d(B,{class:"bg-primary text-white"},{default:_(()=>[y(" Client Details ")]),_:1}),d(D,null,{default:_(()=>[o("p",null,"Client Name: "+m(s.clientName),1),o("p",null,"Account Number: "+m(s.accountNumber),1),o("p",null,"Package Type: "+m(s.packageTypeId),1)]),_:1})]),_:1}),d(M,null,{default:_(()=>[d(B,{class:"bg-primary text-white"},{default:_(()=>[y(" ONU Details ")]),_:1}),d(D,null,{default:_(()=>[o("p",Te,[y(" ONU Status: "),l.value.label!==""?(I(),j("span",{key:0,class:q(a.value==="1"?"up":"down")},m(a.value==="1"?"UP":"Down"),3)):C("",!0)]),o("p",we,[y(" ONU IP: "),o("span",xe,m(t.value.instance),1)]),o("p",null,"ONU Serial Number: "+m(s.onuSerialNumber),1),o("p",null,"ONU Mac Address: "+m(s.onuMacAddress),1),o("p",null," upstream: "+m(S.upStream)+" downstream: "+m(S.downStream),1)]),_:1})]),_:1}),d(M,null,{default:_(()=>[d(B,{class:"bg-primary text-white"},{default:_(()=>[y(" OLT Details ")]),_:1}),d(D,null,{default:_(()=>[o("p",je,[y(" OLT Status: "),l.value.label!==""?(I(),j("span",{key:0,class:q(g.value==="1"?"up":"down")},m(g.value==="1"?"UP":"Down"),3)):C("",!0)]),o("p",Ce,[y(" OLT IP: "),o("span",Le,m(s.oltIp),1)]),o("p",null,"OLT Site: "+m(s.oltSite),1),o("p",null,"OLT Interface: "+m(s.oltInterface),1)]),_:1})]),_:1})])):C("",!0),o("div",Ae,[n.value&&u.value!==""?(I(),j("div",Oe,[o("div",null,[o("iframe",{src:`http://172.91.10.151:3000/d-solo/d94d1e0e-a6e4-45c4-847f-6603e1c31ccb/subscribers-traffic-rate-and-uptime?orgId=1&from=now-${u.value}&to=now&var-Subscriber=${l.value.label}&panelId=3`,class:"grafana-panel",frameborder:"0"},null,8,Be)])])):C("",!0)])]),_:1}))}});var ze=re(De,[["__scopeId","data-v-41617198"]]);export{ze as default};
